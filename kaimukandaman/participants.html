<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Participants</title>
<style>
body {font-family: Arial, sans-serif; background: #f4f6f9; padding:20px;}
h1 {text-align:center;}
table {width:100%; border-collapse:collapse; margin-top:20px;}
th, td {padding:10px; border:1px solid #ddd; text-align:center;}
th {background:#222; color:#fff;}
</style>
</head>
<body>
<h1>Participants Approved</h1>
<table id="participantsTable">
<thead>
<tr>
<th>#</th>
<th>Full Name</th>
<th>Category</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script>
// ใส่ Supabase URL + ANON KEY ของคุณ
const SUPABASE_URL = "https://mdbcfmbvqfyqluzgkowu.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1kYmNmbWJ2cWZ5cWx1emdrb3d1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg2MzU2NDksImV4cCI6MjA3NDIxMTY0OX0.5PM8_3ps5brZJLK2oA_VDGbR9dVt-nr-MCo1ZEhuqeA";
const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// ฟังก์ชันดึงข้อมูล
async function loadParticipants() {
  const { data, error } = await client
    .from("kaimukandaman")
    .select("first_name, last_name, category")
    .eq("status", "Approved")
    .order("id", { ascending:true });

  const tbody = document.querySelector("#participantsTable tbody");
  if(error){ console.error(error); tbody.innerHTML="<tr><td colspan='3'>Error loading data</td></tr>"; return;}
  if(!data || data.length===0){ tbody.innerHTML="<tr><td colspan='3'>No participants approved yet</td></tr>"; return;}

  tbody.innerHTML="";
  data.forEach((p, i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML=`<td>${i+1}</td><td>${p.first_name} ${p.last_name}</td><td>${p.category || "-"}</td>`;
    tbody.appendChild(tr);
  });
}

// โหลดครั้งแรก + รีเฟรชทุก 5 วินาที
loadParticipants();
setInterval(loadParticipants, 5000);
</script>
</body>
</html>
